<!DOCTYPE html>
<html>
<head>
	<title>mapinha</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=drawing"></script>
</head>
<body>
	<style type="text/css">
		html, body, #map-canvas {
	        height: 100vh;
	        margin: 0px;
	        padding: 0px
	      }
	</style>
	<div id="map-canvas"></div>
	<form method="post" accept-charset="utf-8" id="map_form">
	    <input type="text" name="vertices" value="" id="vertices" />
	    <input type="button" name="save" value="Save!" id="save" />
	</form>
	<button id="reboot">reboot</button>
	<script type="text/javascript">
		function KeyPress(e) {
	      var evtobj = window.event? event : e
	      if (evtobj.keyCode == 90 && evtobj.ctrlKey)
	      	alert("ele apertou Ctrl+z");
		}
		var historico = new Array();
		document.onkeydown = KeyPress;
			var Coords = [
	            [{lat: -5.807932394076855, lng: -35.210065841674805},
	            {lat: -5.807889699027975, lng: -35.20161151885986},
	            {lat: -5.81399505815058, lng: -35.203285217285156}],

	            [{lat: -5.806096504053075, lng: -35.21015167236328},
	            {lat: -5.805754942458413, lng: -35.20139694213867},
	            {lat: -5.799777581048758, lng: -35.20912170410156}],
	        ];
            var poligonos = new google.maps.Polygon({
	          paths: Coords,
	          strokeColor: '#a5cd38',
	          strokeOpacity: 0.8,
	          strokeWeight: 3,
	          fillColor: '#a5cd38',
	          fillOpacity: 0.35
	        });
			var map; // Global declaration of the map
            var iw = new google.maps.InfoWindow(); // Global declaration of the infowindow
            var lat_longs = new Array();
            var markers = new Array();
            var myLatlng = new google.maps.LatLng(40.9403762, -74.1318096);
            var drawingManager = new google.maps.drawing.DrawingManager({
	                drawingMode: google.maps.drawing.OverlayType.POLYGON,
	                drawingControl: true,
	                drawingControlOptions: {
	                    position: google.maps.ControlPosition.TOP_CENTER,
	                    drawingModes: [google.maps.drawing.OverlayType.POLYGON]
	                },
	                polygonOptions: {
	                    editable: true
	                }
	            });
            var myOptions = {
                    zoom: 13,
                    center: myLatlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                }
            var infoWindow = new google.maps.InfoWindow({map: map});
            function initialize() {
               
                map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
            	drawingManager.setMap(map);

	            google.maps.event.addListener(drawingManager, "overlaycomplete", function(event) {
	                var newShape = event.overlay;
	                newShape.type = event.type;
	                drawingManager.setMap(null);
	            });
		        poligonos.setMap(map);
	            google.maps.event.addListener(drawingManager, "overlaycomplete", function(event){
	                overlayClickListener(event.overlay);
	                $('#vertices').val(event.overlay.getPath().getArray());
	            });
	            if (navigator.geolocation) {
		          navigator.geolocation.getCurrentPosition(function(position) {
		            var pos = {
		              lat: position.coords.latitude,
		              lng: position.coords.longitude
		            };

		            infoWindow.setPosition(pos);
		            infoWindow.setContent('Location found.');
		            map.setCenter(pos);
		            var myLatlng = new google.maps.LatLng(pos.lat, pos.lon);
		          }, function() {
		            handleLocationError(true, infoWindow, map.getCenter());
		          });
		        } else {
		          // Browser doesn't support Geolocation
		          handleLocationError(false, infoWindow, map.getCenter());
		        }
	        }
		function overlayClickListener(overlay) {
		    google.maps.event.addListener(overlay, "mouseup", function(event){
		        $('#vertices').val(overlay.getPath().getArray());
		    });
		}
		google.maps.event.addDomListener(window, 'load', initialize);

		$(function(){
		    $('#save').click(function(){
		        alert("foi")
		    });
		    $('#reboot').click(function(){
		        map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
            	drawingManager.setMap(map);
            	poligonos.setMap(map);
		    });
		});
		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
	        infoWindow.setPosition(pos);
	        infoWindow.setContent(browserHasGeolocation ?
	                              'Error: The Geolocation service failed.' :
	                              'Error: Your browser doesn\'t support geolocation.');
	      }
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</body>
</html>